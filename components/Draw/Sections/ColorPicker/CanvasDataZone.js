import { useUser } from '@auth0/nextjs-auth0';
import React from 'react';
import { useStore } from '../../../../lib/zustand/store';
import { saveData } from '../../../../utils/prismaHelpers';

const CanvasDataZone = () => {
  const { user } = useUser();
  const { canvasRef, activeUser } = useStore();

  const handleSaveDrawing = async () => {
    const drawingString = await canvasRef.current.getSaveData();
    // console.log(drawingString);
    const data = {
      data: drawingString,
      ownerId: activeUser?.id,
    };
    try {
      await saveData(data);
      await alert('saved');
      canvasRef.current.clear();
    } catch (error) {
      console.log(error);
    }
  };

  return (
    <div>
      <button
        onClick={() =>
          canvasRef.current.loadSaveData(
            '{"lines":[{"points":[{"x":218.47723682640898,"y":344.4995367801803},{"x":218.47723682640898,"y":344.4995367801803},{"x":218.47723682640898,"y":344.4995367801803},{"x":218.47723682640898,"y":344.4995367801803},{"x":218.47723682640898,"y":344.4995367801803},{"x":219.62698813138007,"y":340.5454933700284},{"x":221.72013855257873,"y":331.8356055847184},{"x":223.2200044295039,"y":324.950098171165},{"x":225.0169173485075,"y":315.1096058540949},{"x":226.3512696757212,"y":307.16821965695254},{"x":227.3575938865227,"y":301.16928141446016},{"x":229.84617961890157,"y":288.0777896674148},{"x":235.05890279005698,"y":264.9144249833782},{"x":237.36814138169174,"y":253.98187732073637},{"x":244.04875441026212,"y":217.11539725170184},{"x":245.93014319888832,"y":198.379901241034},{"x":246.1955313612641,"y":195.40506315348327},{"x":245.4226379824666,"y":178.47502953765047},{"x":244.10436339003053,"y":170.20105532717182},{"x":241.40076800624996,"y":161.43420416988877},{"x":235.6434278153047,"y":150.665158213393},{"x":228.2323379757203,"y":141.31128479329286},{"x":221.3827429530042,"y":135.3123613217969},{"x":217.71962403591283,"y":132.641066619608},{"x":208.80981596745468,"y":128.20219384886929},{"x":195.6731540524738,"y":125.06862806615365},{"x":188.29812860550007,"y":124.69955289683881},{"x":183.21677040455515,"y":125.1907532103679},{"x":176.24239062994454,"y":127.36302370465313},{"x":169.73891652675206,"y":130.65666074504898},{"x":164.33257450870758,"y":134.2402111685906},{"x":155.5433847984876,"y":142.77771456796123},{"x":145.4061718947403,"y":158.37626552006378},{"x":136.2536527451001,"y":181.22142386795224},{"x":130.84357440576377,"y":200.4013221365176},{"x":127.36015377419224,"y":220.84111701782845},{"x":125.99087572760884,"y":240.55766803300406},{"x":126.61432615147436,"y":261.51061711498517},{"x":127.72131560704469,"y":271.64199201968444},{"x":130.72662800975547,"y":284.1628358306267},{"x":133.63702443888465,"y":292.76573132562186},{"x":138.12702680941683,"y":301.27418083265303},{"x":141.43358725572918,"y":305.9311006729292},{"x":148.89987888586035,"y":312.99981098941663},{"x":154.19562989800826,"y":317.0104302626937},{"x":157.08239181070743,"y":319.161180173858},{"x":162.5446743905994,"y":322.9126867267511},{"x":166.2550128824329,"y":325.34438637251833},{"x":172.27890962096,"y":329.3079962596706},{"x":175.6896237598781,"y":331.70401257460236},{"x":178.36926221669157,"y":333.7839705775069},{"x":178.85108287220615,"y":334.1833778460219},{"x":179.93071247927912,"y":335.08782258918546},{"x":180.8972444956755,"y":336.0025939965109},{"x":182.332270039642,"y":337.6077496080792},{"x":183.28844859529454,"y":338.7968416131995},{"x":184.29241368424195,"y":340.3488156553463},{"x":185.257762317494,"y":342.205703343905},{"x":185.47142771872763,"y":342.82242720592774},{"x":185.47142771872763,"y":342.82242720592774},{"x":185.49545168670235,"y":343.51444903377615},{"x":180.9361154366879,"y":349.4577675835622},{"x":171.9843186101395,"y":355.72923194732005},{"x":162.0770790864412,"y":360.3519461892502},{"x":141.70739367240725,"y":365.07692003162435},{"x":127.09205805116305,"y":367.1421009634236},{"x":106.3119930660429,"y":366.3798139522919},{"x":88.09616579529076,"y":363.82869895806067},{"x":73.47804396798132,"y":359.8309755785265},{"x":62.595080611520025,"y":355.4544786444883},{"x":58.17223341887672,"y":353.44157569927216},{"x":55.78734540257392,"y":352.24717915146834},{"x":54.59476239797401,"y":351.6234047747573},{"x":53.752372537740094,"y":351.10357538625914},{"x":53.303013006673766,"y":350.80427935368317},{"x":52.14391294059449,"y":349.62393868060025},{"x":51.63442410365251,"y":348.6699693098206},{"x":51.37544740660673,"y":347.15627150116813},{"x":52.850047746325544,"y":340.8664432381733},{"x":53.62763007319141,"y":338.86741800093563},{"x":60.416634006212014,"y":330.3055161147515},{"x":89.54155052761777,"y":313.4965962549428},{"x":101.39191333872775,"y":308.23666359446923},{"x":113.5776172018798,"y":304.1429310429751},{"x":128.07476501512815,"y":300.4398021359268},{"x":137.98431349060144,"y":298.0737298296267},{"x":157.78431411830047,"y":294.1571417378868},{"x":178.67505572383715,"y":290.56599481271695},{"x":189.81202219205343,"y":288.29509214990577},{"x":211.7640115344935,"y":284.05330172344594},{"x":231.5951478860285,"y":281.07012567113617},{"x":247.48532480364938,"y":279.24242206760783},{"x":255.4166405426939,"y":278.5593472383278},{"x":256.4097122390217,"y":278.47725339687895},{"x":259.39260929236906,"y":278.25814897257123},{"x":261.33837260430215,"y":278.20127027108566},{"x":261.33837260430215,"y":278.20127027108566},{"x":262.32983961921724,"y":278.21312235620854},{"x":263.3598625344417,"y":278.26614653134715},{"x":264.52692796610756,"y":278.41730316868},{"x":265.5113989049516,"y":278.539669256073},{"x":267.7592215533136,"y":278.9715576275309},{"x":273.3309594682465,"y":280.63484322792795},{"x":274.5218378178952,"y":281.0251578633819},{"x":276.34871367119996,"y":281.57564768503096},{"x":276.34871367119996,"y":281.57564768503096},{"x":277.5401917374543,"y":281.96938929290843},{"x":277.5401917374543,"y":281.96938929290843}],"brushColor":"#000000","brushRadius":12},{"points":[{"x":285.3890189687579,"y":340.58864880334994},{"x":285.3890189687579,"y":340.58864880334994},{"x":285.2550283817054,"y":341.67914282410976},{"x":285.0785140354812,"y":342.7948406020431},{"x":285.0785140354812,"y":342.7948406020431},{"x":284.9301981349185,"y":343.77185070152547},{"x":284.7192865660302,"y":344.905134030874},{"x":284.7192865660302,"y":344.905134030874},{"x":284.7192865660302,"y":344.905134030874},{"x":284.7192865660302,"y":344.905134030874},{"x":284.5393626625189,"y":345.3380257936123},{"x":284.32323734537607,"y":345.712569186602},{"x":283.41561073103253,"y":346.8353871104732},{"x":279.3889370595599,"y":349.91626098594276},{"x":270.3172958446556,"y":353.88353674345143},{"x":263.1818919854148,"y":356.17160764039164},{"x":259.25100144866934,"y":357.39072891788203},{"x":244.66433328419535,"y":360.8945220617103},{"x":234.38986801852488,"y":363.85500120786173},{"x":219.85019798680958,"y":369.2080624473636},{"x":212.21229757304596,"y":372.6469298798221},{"x":207.14440820130284,"y":375.5550281003613},{"x":202.883582104044,"y":378.586549764638},{"x":201.94337570411977,"y":379.35165219494985},{"x":201.94337570411977,"y":379.35165219494985},{"x":201.94337570411977,"y":379.35165219494985},{"x":201.94337570411977,"y":379.35165219494985},{"x":201.94337570411977,"y":379.35165219494985},{"x":202.99981051360655,"y":382.646208043554},{"x":205.3536959111849,"y":386.3093043750516},{"x":215.59079216814146,"y":394.5029216729339},{"x":216.88078136435792,"y":395.435831858327},{"x":231.860451610075,"y":401.0617743308409},{"x":247.64121343111208,"y":403.63603567204837},{"x":258.40951510391017,"y":404.5251327541644},{"x":281.52360079082666,"y":401.55689829318544},{"x":308.0019085748767,"y":395.14691307603624},{"x":333.7841518007974,"y":385.7322094478722},{"x":346.1377102729901,"y":380.6425102812795},{"x":357.4932187743194,"y":375.4617704307887},{"x":403.36897481563693,"y":344.8278776974446},{"x":413.54124065762915,"y":335.61293720558496},{"x":422.43938945644214,"y":323.0730177796147},{"x":429.76003927768335,"y":303.918472451419},{"x":432.6850531060117,"y":291.82714598057976},{"x":433.3510899423239,"y":275.48010430536266},{"x":430.9929666303464,"y":260.2185357015242},{"x":426.97182462765187,"y":248.25024958109768},{"x":423.06169790953606,"y":239.43758324006419},{"x":417.0591339316038,"y":229.84505865273985},{"x":412.2350907715852,"y":223.06006909568467},{"x":404.6689194776235,"y":213.95697767228745},{"x":401.9221550288669,"y":210.74352563126982},{"x":397.04541778995605,"y":205.7201080651337},{"x":386.36115723874667,"y":196.33697408838958},{"x":379.7740889338874,"y":190.85403577401473},{"x":373.4305542669751,"y":186.02918428887915},{"x":366.54494607258533,"y":180.87754457006622},{"x":361.44637246628645,"y":177.00836358166666},{"x":359.67238399710084,"y":175.7056201502463},{"x":355.2533211638183,"y":172.2593004631316},{"x":353.69498875389695,"y":170.94857002592104},{"x":350.49382445810903,"y":168.18462186976967},{"x":348.96652320331077,"y":166.77534665748914},{"x":347.0112292597947,"y":164.75323251616408},{"x":345.5626239996761,"y":163.17600187343044},{"x":344.6043551740076,"y":162.1375829217817},{"x":342.7336892635791,"y":159.90295057105612},{"x":337.3581452353696,"y":153.2109190507677},{"x":334.3287744658043,"y":148.99312223671913},{"x":331.0130279673621,"y":144.21607036845535},{"x":327.82524254946946,"y":138.98955960860903},{"x":324.1141712280845,"y":132.40667630948198},{"x":323.02555775460263,"y":130.45638487314903},{"x":319.887747539286,"y":124.0521314915208},{"x":317.9081570817798,"y":119.50506726442957},{"x":315.78662625671785,"y":114.55757815302184},{"x":315.10966090518315,"y":112.8357253552684},{"x":313.4139629274852,"y":108.09688529444803},{"x":312.07638330003294,"y":103.531739185655},{"x":310.7222028654281,"y":98.63256942604609},{"x":310.4749768267172,"y":97.6994873352922},{"x":310.01562823264226,"y":95.81635278037035},{"x":308.8444758553315,"y":90.85743721474776},{"x":307.4771686954814,"y":85.69890647489791},{"x":306.2162318907755,"y":81.49030194367293},{"x":303.43396968490555,"y":74.70548564148906},{"x":302.5746601993791,"y":72.6472704143568},{"x":300.83613243258714,"y":69.07734413213763},{"x":298.5282974345632,"y":65.16774764135955},{"x":295.05517711410624,"y":60.18674783341859},{"x":292.01384471282677,"y":56.66475150093274},{"x":287.5037434155828,"y":52.2629988976404},{"x":276.0605324382218,"y":45.589966162713814},{"x":271.19571824820287,"y":43.38981119795277},{"x":267.745582715502,"y":42.07074031654673},{"x":258.5308822258774,"y":39.63449729945283},{"x":251.98866162195404,"y":38.52231360800864},{"x":238.29359733091462,"y":37.786909459195286},{"x":224.32389268395187,"y":38.0492969294408},{"x":209.17331973962985,"y":39.77847692842247},{"x":202.05180057972905,"y":40.86857920535679},{"x":198.97561918168773,"y":41.40170536356349},{"x":186.58264927918074,"y":44.564757751448326},{"x":180.28136073115854,"y":46.48936739873874},{"x":174.6582664272762,"y":48.70427468381129},{"x":165.6144147607886,"y":53.41424931636355},{"x":160.57800438559838,"y":56.61813736803884},{"x":154.54840150898067,"y":61.12707507435158},{"x":152.53191701270683,"y":62.85960498075222},{"x":147.13266591915777,"y":68.3650239423467},{"x":142.18162597229056,"y":74.64864702823262},{"x":136.95712721111042,"y":83.0914649435152},{"x":133.01723290672038,"y":91.01179458031714},{"x":127.96549409289217,"y":104.10812970846001},{"x":126.84443844255124,"y":107.06180922292928},{"x":124.7103291935818,"y":113.66355848114108},{"x":123.73449047545415,"y":116.67138308079089},{"x":122.26822520283872,"y":121.52533984637513},{"x":120.47361950507369,"y":128.30015307619232},{"x":119.2709581275745,"y":134.01450659081328},{"x":118.13467628848545,"y":143.6646634203521},{"x":117.77868569451016,"y":149.5438760716275},{"x":117.72921925576729,"y":152.50335182993277},{"x":118.32288737142335,"y":159.58391708383374},{"x":120.31210562544388,"y":167.2662419982267},{"x":122.92970555008515,"y":173.4167549521484},{"x":128.80628193390555,"y":183.02554161331483},{"x":138.91868392582836,"y":195.10029549743714},{"x":153.552258888925,"y":208.37490824828785},{"x":158.62739613716312,"y":212.4573027684973},{"x":169.83270085572056,"y":220.50255603923893},{"x":181.06711910476207,"y":227.63564459006463},{"x":194.04729954279506,"y":234.4037633469731},{"x":207.26318685374315,"y":240.05868099247465},{"x":219.51197092456792,"y":244.05532987929325},{"x":227.18148758618327,"y":246.1570372511499},{"x":234.00987948383846,"y":247.82026179758145},{"x":238.96917338736918,"y":248.9900653761799},{"x":246.82913254976916,"y":250.621746847078},{"x":249.72475029212387,"y":251.15480697786705},{"x":251.66645861845123,"y":251.4843376575856},{"x":253.61668622161073,"y":251.78951875645515},{"x":254.5941833296316,"y":251.93629226962278},{"x":254.5941833296316,"y":251.93629226962278},{"x":256.55499680092436,"y":252.2078311661891},{"x":257.43020369130636,"y":252.2888109254326},{"x":258.42221577046695,"y":252.3769117047741},{"x":258.42221577046695,"y":252.3769117047741},{"x":258.42221577046695,"y":252.3769117047741}],"brushColor":"#000000","brushRadius":12}],"width":500,"height":500}'
          )
        }
      >
        load{' '}
      </button>
      <button onClick={() => canvasRef.current.undo()}>UNDO</button>
      <button onClick={() => canvasRef.current.clear()}>CLEAR</button>
      {user && <button onClick={() => handleSaveDrawing()}>SAVE </button>}
    </div>
  );
};

export default CanvasDataZone;
